---
phase: 01-foundation-build-system
plan: 03
type: execute
wave: 2
depends_on: ["01-01", "01-02"]
files_modified: []
autonomous: true

must_haves:
  truths:
    - "npm run build completes without errors"
    - "dist/ contains ESM (.js) and CJS (.cjs) bundles"
    - "dist/ contains TypeScript declarations (.d.ts)"
    - "Package can be imported in a test file"
  artifacts:
    - path: "dist/index.js"
      provides: "ESM bundle"
      min_lines: 1
    - path: "dist/index.cjs"
      provides: "CJS bundle"
      min_lines: 1
    - path: "dist/index.d.ts"
      provides: "TypeScript declarations"
      contains: "Body"
  key_links:
    - from: "package.json"
      to: "dist/index.js"
      via: "module field"
      pattern: '"module".*dist/index.js'
    - from: "package.json"
      to: "dist/index.cjs"
      via: "main field"
      pattern: '"main".*dist/index.cjs'
---

<objective>
Build the package and verify all outputs are correct.

Purpose: Confirm the migration is complete and the package builds successfully with all expected outputs (ESM, CJS, TypeScript declarations).

Output:
- Successful build with no errors
- dist/ directory with correct files
- Verification that exports are properly configured
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-build-system/01-RESEARCH.md
@.planning/phases/01-foundation-build-system/01-01-SUMMARY.md
@.planning/phases/01-foundation-build-system/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build the package and verify outputs</name>
  <files></files>
  <action>
**Run the build:**

```bash
npm run build
```

This should:
1. Execute tsup
2. Generate dist/index.js (ESM)
3. Generate dist/index.cjs (CJS)
4. Generate dist/index.d.ts (TypeScript declarations)
5. Generate dist/index.d.cts (CJS TypeScript declarations)

**Verify outputs exist:**

```bash
ls -la dist/
```

Expected files:
- index.js (ESM bundle)
- index.js.map (ESM sourcemap)
- index.cjs (CJS bundle)
- index.cjs.map (CJS sourcemap)
- index.d.ts (TypeScript declarations)
- index.d.cts (CJS TypeScript declarations)

**Verify no react-native in bundles:**

```bash
grep -l "react-native" dist/* || echo "No react-native references found - GOOD"
```

**Verify TypeScript types export Body:**

```bash
grep "Body" dist/index.d.ts
```

Should show the Body component export.
  </action>
  <verify>
- `npm run build` exits with code 0
- `ls dist/index.js` exists
- `ls dist/index.cjs` exists
- `ls dist/index.d.ts` exists
- `grep "react-native" dist/index.js` returns no matches
- `grep "Body" dist/index.d.ts` returns matches
  </verify>
  <done>
- Build completes successfully
- ESM bundle generated (dist/index.js)
- CJS bundle generated (dist/index.cjs)
- TypeScript declarations generated
- No react-native references in output
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify TypeScript compilation</name>
  <files></files>
  <action>
**Run TypeScript type checking:**

```bash
npm run typecheck
```

This should complete without errors, confirming:
1. All imports resolve correctly
2. JSX syntax is valid for web
3. No type errors in source files

If there are errors, they need to be fixed in the source files.

Common issues to watch for:
- Missing react or react-dom types (should be in devDependencies)
- JSX transform errors (tsconfig should have "jsx": "react-jsx")
- Import path errors (relative paths should be correct)
  </action>
  <verify>
- `npm run typecheck` exits with code 0
- No TypeScript errors reported
  </verify>
  <done>
- TypeScript type checking passes
- All source files compile without errors
  </done>
</task>

<task type="auto">
  <name>Task 3: Create smoke test for package import</name>
  <files></files>
  <action>
**Create a simple test script to verify the package can be imported:**

Create a temporary test file that imports from the built package:

```bash
# Create a simple import test
node --input-type=module -e "
import { Body } from './dist/index.js';
console.log('ESM import successful');
console.log('Body component:', typeof Body);
"

# Test CJS import
node -e "
const { Body } = require('./dist/index.cjs');
console.log('CJS import successful');
console.log('Body component:', typeof Body);
"
```

Both should output:
- "ESM import successful" / "CJS import successful"
- "Body component: function"

This confirms:
1. ESM bundle works with ES module imports
2. CJS bundle works with require()
3. Body component is properly exported
  </action>
  <verify>
- ESM import test succeeds, outputs "Body component: function"
- CJS import test succeeds, outputs "Body component: function"
  </verify>
  <done>
- ESM import works correctly
- CJS import works correctly
- Body component is accessible from both module systems
  </done>
</task>

</tasks>

<verification>
After all tasks complete, verify Phase 1 success criteria:

1. **User can `npm install` and import `{ Body }`:**
   - Package builds successfully
   - Both ESM and CJS exports work
   - Body component is exported

2. **Package exports ESM and CJS bundles:**
   - `ls dist/` shows index.js and index.cjs

3. **TypeScript declarations are generated:**
   - `ls dist/` shows index.d.ts

4. **No react-native or react-native-svg in node_modules:**
   - Already verified in Plan 01

5. **Minimal `<Body />` renders SVG:**
   - Component exports successfully
   - Full render test deferred to Phase 2 (requires test setup)

Run final verification:
```bash
echo "=== Phase 1 Verification ===" && \
echo "1. Build:" && ls dist/index.js dist/index.cjs dist/index.d.ts && \
echo "2. No RN deps:" && (npm ls react-native 2>&1 | grep -q "empty" || echo "No react-native") && \
echo "3. Exports:" && node -e "const {Body} = require('./dist/index.cjs'); console.log('Body:', typeof Body);" && \
echo "=== Phase 1 Complete ==="
```
</verification>

<success_criteria>
- [x] npm run build succeeds
- [x] dist/index.js exists (ESM)
- [x] dist/index.cjs exists (CJS)
- [x] dist/index.d.ts exists (declarations)
- [x] TypeScript compiles without errors
- [x] Package can be imported (ESM and CJS)
- [x] Body component is exported and is a function
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-build-system/01-03-SUMMARY.md`

This summary should include:
- Build output details
- Any issues encountered and how they were resolved
- Confirmation that all Phase 1 requirements are met
</output>
