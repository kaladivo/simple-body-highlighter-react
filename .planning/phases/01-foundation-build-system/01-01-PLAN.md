---
phase: 01-foundation-build-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - tsup.config.ts
  - .gitignore
autonomous: true

must_haves:
  truths:
    - "npm install succeeds without react-native or react-native-svg"
    - "npm run build command exists and uses tsup"
    - "TypeScript compiles with jsx: react-jsx setting"
  artifacts:
    - path: "package.json"
      provides: "Package configuration for web-only React library"
      contains: "react-body-highlighter"
    - path: "tsconfig.json"
      provides: "TypeScript configuration for web bundling"
      contains: "react-jsx"
    - path: "tsup.config.ts"
      provides: "tsup bundler configuration"
      contains: "format: ['esm', 'cjs']"
  key_links:
    - from: "package.json"
      to: "tsup.config.ts"
      via: "build script"
      pattern: '"build":\\s*"tsup"'
    - from: "tsconfig.json"
      to: "tsup.config.ts"
      via: "TypeScript config inheritance"
      pattern: "moduleResolution.*bundler"
---

<objective>
Set up the build system for a web-only React library with ESM + CJS dual output.

Purpose: Transform the project from a React Native package to a web-only React component library with modern bundling.

Output:
- package.json renamed and reconfigured for web
- tsup.config.ts for dual-format bundling
- tsconfig.json updated for web/bundler targets
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-build-system/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure package.json for web-only React library</name>
  <files>package.json</files>
  <action>
Update package.json with the following changes:

1. Rename package: "name": "react-body-highlighter"
2. Bump version to "4.0.0" (major breaking change)
3. Set "type": "module" for ESM-first
4. Update entry points:
   - "main": "./dist/index.cjs"
   - "module": "./dist/index.js"
   - "types": "./dist/index.d.ts"
5. Add exports field:
   ```json
   "exports": {
     ".": {
       "import": {
         "types": "./dist/index.d.ts",
         "default": "./dist/index.js"
       },
       "require": {
         "types": "./dist/index.d.cts",
         "default": "./dist/index.cjs"
       }
     },
     "./package.json": "./package.json"
   }
   ```
6. Update scripts:
   - "build": "tsup"
   - "dev": "tsup --watch"
   - "typecheck": "tsc --noEmit"
   - Remove "prepare" script (or keep as "build")
7. Update peerDependencies:
   - "react": "^18.0.0 || ^19.0.0"
   - "react-dom": "^18.0.0 || ^19.0.0"
   - Remove "react-native"
8. Remove from dependencies:
   - "react-native-svg"
9. Remove from devDependencies (React Native related):
   - "@babel/plugin-transform-flow-strip-types"
   - "@babel/preset-flow"
   - "@react-native/babel-preset"
   - "@testing-library/jest-native"
   - "@testing-library/react-native"
   - "@types/react-native"
   - "metro-react-native-babel-preset"
   - "react-native"
   - "react-native-typescript-transformer"
10. Add to devDependencies:
    - "tsup": "^8.4.0"
    - "@types/react-dom": "^18.3.0"
11. Update "files": ["dist", "README.md", "LICENSE"]
12. Add "sideEffects": false
13. Update keywords to remove "react-native", keep: ["react", "body", "highlighter", "anatomy", "muscle", "svg", "interactive"]

Keep existing: author, license, publishConfig, packageManager
  </action>
  <verify>
- `cat package.json | grep '"name"'` shows "react-body-highlighter"
- `cat package.json | grep 'react-native'` returns no matches
- `cat package.json | grep '"build"'` shows "tsup"
  </verify>
  <done>
- Package renamed to react-body-highlighter
- All react-native dependencies removed
- tsup configured as build tool
- Modern exports field configured for dual ESM/CJS
  </done>
</task>

<task type="auto">
  <name>Task 2: Create tsup.config.ts and update tsconfig.json</name>
  <files>tsup.config.ts, tsconfig.json</files>
  <action>
**Create tsup.config.ts:**

```typescript
import { defineConfig } from 'tsup';

export default defineConfig({
  entry: ['src/index.tsx'],
  format: ['esm', 'cjs'],
  dts: true,
  sourcemap: true,
  clean: true,
  external: ['react', 'react-dom'],
  outExtension({ format }) {
    return {
      js: format === 'cjs' ? '.cjs' : '.js',
    };
  },
});
```

**Update tsconfig.json:**

Replace entire file with:

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "jsx": "react-jsx",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "declaration": true,
    "declarationMap": true,
    "outDir": "./dist",
    "rootDir": "./src"
  },
  "include": ["src"],
  "exclude": ["node_modules", "dist", "__tests__"]
}
```

Key changes from current tsconfig:
- target: es6 -> ES2020
- module: commonjs -> ESNext
- jsx: react-native -> react-jsx (React 17+ transform)
- Added moduleResolution: bundler
- Added declarationMap
- Updated rootDir to ./src
  </action>
  <verify>
- `cat tsup.config.ts` shows the config file exists
- `cat tsconfig.json | grep 'react-jsx'` confirms JSX setting
- `cat tsconfig.json | grep 'bundler'` confirms moduleResolution
  </verify>
  <done>
- tsup.config.ts created with ESM+CJS dual output
- tsconfig.json updated for modern web bundling
- TypeScript configured for React 17+ JSX transform
  </done>
</task>

<task type="auto">
  <name>Task 3: Update .gitignore and install dependencies</name>
  <files>.gitignore</files>
  <action>
**Update .gitignore** to ensure dist/ is ignored (if not already):

Check current .gitignore and ensure it includes:
- node_modules/
- dist/
- *.log

**Install new dependencies:**

Run: `npm install`

This will:
1. Remove react-native and react-native-svg from node_modules
2. Install tsup and other new devDependencies
3. Update package-lock.json

Note: Use npm (not yarn) since we're modernizing. The packageManager field can be updated or removed.
  </action>
  <verify>
- `npm install` completes without errors
- `ls node_modules | grep -E '^react-native$'` returns empty (no react-native)
- `ls node_modules | grep -E '^react-native-svg$'` returns empty (no react-native-svg)
- `ls node_modules/tsup` confirms tsup is installed
  </verify>
  <done>
- Dependencies installed successfully
- No React Native packages in node_modules
- tsup available for building
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. `cat package.json | jq '.name'` returns "react-body-highlighter"
2. `cat package.json | jq '.peerDependencies'` shows only react and react-dom
3. `ls node_modules/tsup` exists
4. `grep -r "react-native" node_modules/` returns no matches for react-native packages
5. Build system is ready (build command exists, will be tested in Plan 02)
</verification>

<success_criteria>
- [x] PKG-01: Package renamed to react-body-highlighter
- [x] PKG-02: package.json configured for web-only React library
- [x] PKG-03: All React Native dependencies removed
- [x] PKG-04: tsup bundler configured with ESM + CJS output
- [x] PKG-05: React 18/19 as peer dependency
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-build-system/01-01-SUMMARY.md`
</output>
