---
phase: 02-core-migration
plan: 04
type: execute
wave: 4
depends_on: ["02-03"]
files_modified:
  - __tests__/test.tsx
  - jest.config.js
autonomous: false

must_haves:
  truths:
    - "Tests use @testing-library/react (not react-native)"
    - "Tests verify new API: data as { slug, color }[]"
    - "Tests verify onClick callback receives slug"
    - "Tests verify cursor:pointer on interactive parts"
    - "Tests verify disabled parts behavior"
    - "Tests verify hidden parts behavior"
    - "All tests pass"
  artifacts:
    - path: "__tests__/test.tsx"
      provides: "Test suite for Body component"
      min_lines: 80
    - path: "jest.config.js"
      provides: "Jest configuration for web testing"
  key_links:
    - from: "__tests__/test.tsx"
      to: "src/index.tsx"
      via: "import Body"
      pattern: "import.*Body.*from"
---

<objective>
Migrate tests from React Native testing library to web testing library

Purpose: Update the test suite to use @testing-library/react (web) instead of @testing-library/react-native, and update tests to verify the new simplified API works correctly.

Output: Updated test file using web testing library, testing the new API (data as { slug, color }[], onClick callback, disabled/hidden parts).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-migration/02-RESEARCH.md
@src/index.tsx
@src/types.ts
@__tests__/test.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @testing-library/react if needed</name>
  <files>package.json</files>
  <action>
Check if @testing-library/react is in devDependencies:
```bash
grep "@testing-library/react" package.json
```

If NOT present, install it:
```bash
npm install --save-dev @testing-library/react @testing-library/jest-dom
```

The research indicated @testing-library/react ^16.x should already be available. Verify and install @testing-library/jest-dom for better assertions if not present.
  </action>
  <verify>
`grep "@testing-library/react" package.json` should show it in devDependencies.
`grep "@testing-library/jest-dom" package.json` should show it in devDependencies.
  </verify>
  <done>
@testing-library/react and @testing-library/jest-dom are in devDependencies.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update jest.config.js for web testing</name>
  <files>jest.config.js</files>
  <action>
Create or update `jest.config.js` for web testing:

```javascript
/** @type {import('jest').Config} */
const config = {
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],
  moduleFileExtensions: ['ts', 'tsx', 'js', 'jsx'],
  transform: {
    '^.+\\.(ts|tsx)$': 'babel-jest',
  },
  testMatch: ['**/__tests__/**/*.test.tsx', '**/__tests__/**/*.test.ts'],
  moduleNameMapper: {
    '^(\\.{1,2}/.*)\\.js$': '$1',
  },
};

module.exports = config;
```

Create `jest.setup.js`:
```javascript
import '@testing-library/jest-dom';
```

Note: The testEnvironment should be 'jsdom' for web testing.
  </action>
  <verify>
`cat jest.config.js` should show testEnvironment: 'jsdom'.
`cat jest.setup.js` should import @testing-library/jest-dom.
  </verify>
  <done>
jest.config.js configured for web testing with jsdom environment. jest.setup.js imports jest-dom matchers.
  </done>
</task>

<task type="auto">
  <name>Task 3: Rewrite tests for new API</name>
  <files>__tests__/test.tsx</files>
  <action>
Rewrite `__tests__/test.tsx` (rename to `__tests__/Body.test.tsx` for clarity):

```typescript
import React from 'react';
import { render, screen, fireEvent } from '@testing-library/react';
import { Body } from '../src';
import type { BodyPartSlug, BodyPartData } from '../src';

describe('Body Component', () => {
  describe('Basic Rendering', () => {
    it('renders without crashing', () => {
      render(<Body data={[]} />);
      expect(screen.getByRole('img')).toBeInTheDocument();
    });

    it('renders male front view by default', () => {
      render(<Body data={[]} />);
      expect(screen.getByRole('img')).toHaveAttribute('aria-label', 'male-body-front');
    });

    it('renders male back view when side="back"', () => {
      render(<Body data={[]} side="back" />);
      expect(screen.getByRole('img')).toHaveAttribute('aria-label', 'male-body-back');
    });

    it('renders female front view', () => {
      render(<Body data={[]} gender="female" />);
      expect(screen.getByRole('img')).toHaveAttribute('aria-label', 'female-body-front');
    });

    it('renders female back view', () => {
      render(<Body data={[]} gender="female" side="back" />);
      expect(screen.getByRole('img')).toHaveAttribute('aria-label', 'female-body-back');
    });
  });

  describe('Color Highlighting', () => {
    it('highlights body part with specified color', () => {
      const data: BodyPartData[] = [{ slug: 'left-biceps', color: '#ff0000' }];
      render(<Body data={data} />);

      const paths = screen.getAllByTestId('left-biceps');
      expect(paths.length).toBeGreaterThan(0);
      paths.forEach(path => {
        expect(path).toHaveAttribute('fill', '#ff0000');
      });
    });

    it('applies defaultFill to non-highlighted parts', () => {
      render(<Body data={[]} defaultFill="#cccccc" />);

      // Find any body part that's not highlighted
      const paths = screen.getAllByTestId('left-biceps');
      paths.forEach(path => {
        expect(path).toHaveAttribute('fill', '#cccccc');
      });
    });

    it('highlights multiple body parts with different colors', () => {
      const data: BodyPartData[] = [
        { slug: 'left-biceps', color: '#ff0000' },
        { slug: 'right-biceps', color: '#00ff00' },
      ];
      render(<Body data={data} />);

      screen.getAllByTestId('left-biceps').forEach(path => {
        expect(path).toHaveAttribute('fill', '#ff0000');
      });
      screen.getAllByTestId('right-biceps').forEach(path => {
        expect(path).toHaveAttribute('fill', '#00ff00');
      });
    });
  });

  describe('Click Handling', () => {
    it('calls onClick with correct slug when body part clicked', () => {
      const handleClick = jest.fn();
      render(<Body data={[]} onClick={handleClick} />);

      const path = screen.getAllByTestId('left-biceps')[0];
      fireEvent.click(path);

      expect(handleClick).toHaveBeenCalledTimes(1);
      expect(handleClick).toHaveBeenCalledWith('left-biceps', expect.any(Object));
    });

    it('passes MouseEvent as second argument to onClick', () => {
      const handleClick = jest.fn();
      render(<Body data={[]} onClick={handleClick} />);

      const path = screen.getAllByTestId('left-biceps')[0];
      fireEvent.click(path);

      const [slug, event] = handleClick.mock.calls[0];
      expect(slug).toBe('left-biceps');
      expect(event).toHaveProperty('type', 'click');
    });
  });

  describe('Interactive States', () => {
    it('shows cursor:pointer on interactive body parts', () => {
      render(<Body data={[]} />);

      const path = screen.getAllByTestId('left-biceps')[0];
      expect(path).toHaveStyle({ cursor: 'pointer' });
    });

    it('shows cursor:default on disabled body parts', () => {
      render(<Body data={[]} disabledParts={['left-biceps']} />);

      const paths = screen.getAllByTestId('left-biceps');
      paths.forEach(path => {
        expect(path).toHaveStyle({ cursor: 'default' });
      });
    });

    it('sets aria-disabled on disabled body parts', () => {
      render(<Body data={[]} disabledParts={['left-biceps']} />);

      const paths = screen.getAllByTestId('left-biceps');
      paths.forEach(path => {
        expect(path).toHaveAttribute('aria-disabled', 'true');
      });
    });

    it('applies gray color to disabled body parts', () => {
      render(<Body data={[{ slug: 'left-biceps', color: '#ff0000' }]} disabledParts={['left-biceps']} />);

      const paths = screen.getAllByTestId('left-biceps');
      paths.forEach(path => {
        expect(path).toHaveAttribute('fill', '#EBEBE4');
      });
    });

    it('does not call onClick on disabled body parts', () => {
      const handleClick = jest.fn();
      render(<Body data={[]} onClick={handleClick} disabledParts={['left-biceps']} />);

      const path = screen.getAllByTestId('left-biceps')[0];
      fireEvent.click(path);

      expect(handleClick).not.toHaveBeenCalled();
    });
  });

  describe('Hidden Parts', () => {
    it('does not render hidden body parts', () => {
      render(<Body data={[]} hiddenParts={['left-biceps']} />);

      expect(screen.queryByTestId('left-biceps')).not.toBeInTheDocument();
    });

    it('renders other parts when some are hidden', () => {
      render(<Body data={[]} hiddenParts={['left-biceps']} />);

      // right-biceps should still be rendered
      expect(screen.getAllByTestId('right-biceps').length).toBeGreaterThan(0);
    });
  });

  describe('Scaling', () => {
    it('applies scale to SVG dimensions', () => {
      render(<Body data={[]} scale={2} />);

      const svg = screen.getByRole('img');
      // Default is 200x400, scaled by 2 should be 400x800
      expect(svg).toHaveAttribute('width', '400');
      expect(svg).toHaveAttribute('height', '800');
    });
  });
});
```

Delete the old `__tests__/test.tsx` file and create this as `__tests__/Body.test.tsx`.
  </action>
  <verify>
Run `npm test` - all tests should pass.
Test count should be at least 15 tests.
No React Native testing library imports remaining.
  </verify>
  <done>
Tests rewritten for web testing library. Tests cover: rendering, color highlighting, onClick callback, cursor:pointer, disabled/hidden parts, scaling. All tests pass.
  </done>
</task>

</tasks>

<verification>
1. `npm test` runs successfully
2. All tests pass (0 failures)
3. Tests use @testing-library/react (not react-native)
4. Tests verify new API (data as { slug, color }[])
5. Tests verify onClick callback
6. Tests verify disabled/hidden behavior
</verification>

<success_criteria>
- @testing-library/react installed
- jest.config.js uses jsdom environment
- Tests use web testing library imports
- Tests verify new simplified API
- All tests pass
- Old React Native test patterns removed
</success_criteria>

<checkpoint type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Phase 2 implementation: simplified API, bilateral slug split, component refactor, and test migration</what-built>
  <how-to-verify>
    1. Run `npm test` - all tests should pass
    2. Run `npm run build` - build should succeed
    3. Run `npm run typecheck` - no TypeScript errors
    4. Create a simple test file to verify the API works:
       ```javascript
       // test-api.mjs
       import { Body } from './dist/index.js';
       console.log('Body component:', typeof Body);
       ```
       Run: `node test-api.mjs`
    5. Optionally: Create a small React app to visually verify the component renders correctly
  </how-to-verify>
  <resume-signal>Type "approved" if all verifications pass, or describe any issues found</resume-signal>
</checkpoint>

<output>
After completion, create `.planning/phases/02-core-migration/02-04-SUMMARY.md`
</output>
