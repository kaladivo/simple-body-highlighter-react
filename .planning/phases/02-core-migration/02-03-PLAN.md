---
phase: 02-core-migration
plan: 03
type: execute
wave: 3
depends_on: ["02-01", "02-02"]
files_modified:
  - src/index.tsx
autonomous: true

must_haves:
  truths:
    - "User can pass data as array of { slug, color } objects"
    - "User can click body parts and receive slug in onClick callback"
    - "User sees cursor:pointer on hoverable parts"
    - "User can disable parts (grayed out, non-interactive)"
    - "User can hide parts (not rendered)"
    - "No intensity system - direct colors only"
    - "No exercise-related code remains"
  artifacts:
    - path: "src/index.tsx"
      provides: "Refactored Body component with simplified API"
      exports: ["Body", "BodyPartSlug", "BodyPartData", "ModelProps"]
      min_lines: 100
  key_links:
    - from: "src/index.tsx"
      to: "src/types.ts"
      via: "import types"
      pattern: "import.*from.*types"
    - from: "src/index.tsx"
      to: "src/assets/bodyFront.ts"
      via: "import assets"
      pattern: "import.*bodyFront"
---

<objective>
Refactor the Body component to use the new simplified API

Purpose: Transform the Body component from the old complex API (intensity, colors array, side prop, onBodyPartPress) to the new simplified API (direct colors, onClick callback). This is the main component refactor that makes the library consumer-friendly.

Output: Refactored `src/index.tsx` with simplified props, direct color application, and clean onClick handling. Old types removed, new types used throughout.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-migration/02-RESEARCH.md
@src/types.ts
@src/assets/bodyFront.ts
@src/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor Body component with new API</name>
  <files>src/index.tsx</files>
  <action>
Completely refactor `src/index.tsx`:

1. **Update imports:**
```typescript
import React, { memo, useCallback, useMemo } from "react";
import { BodyPartSlug, BodyPartData, ModelProps } from "./types";
import { bodyFront, BodyPartAsset } from "./assets/bodyFront";
import { bodyBack } from "./assets/bodyBack";
import { bodyFemaleFront } from "./assets/bodyFemaleFront";
import { bodyFemaleBack } from "./assets/bodyFemaleBack";
import { SvgMaleWrapper } from "./components/SvgMaleWrapper";
import { SvgFemaleWrapper } from "./components/SvgFemaleWrapper";
```

2. **Update type exports at top of file:**
```typescript
// Export types
export type { BodyPartSlug, BodyPartData, ModelProps } from "./types";
```

3. **Remove old types** (Slug, BodyPart, ExtendedBodyPart, BodyProps, BodyPartStyles, differenceWith import).

4. **Simplify component props** to use ModelProps:
```typescript
const Body = ({
  data = [],
  onClick,
  gender = "male",
  side = "front",
  scale = 1,
  border = "#dfdfdf",
  disabledParts = [],
  hiddenParts = [],
  defaultFill = "#3f3f3f",
}: ModelProps) => {
```

5. **Simplify color resolution** - create a Map for O(1) lookup:
```typescript
const colorMap = useMemo(() => {
  const map = new Map<BodyPartSlug, string>();
  data.forEach(item => map.set(item.slug, item.color));
  return map;
}, [data]);

const getColor = useCallback((slug: BodyPartSlug): string => {
  if (disabledParts.includes(slug)) return "#EBEBE4";
  return colorMap.get(slug) ?? defaultFill;
}, [colorMap, disabledParts, defaultFill]);
```

6. **Simplify rendering** - iterate over asset entries directly:
```typescript
const renderBodySvg = (assets: BodyPartAsset[]) => {
  const SvgWrapper = gender === "male" ? SvgMaleWrapper : SvgFemaleWrapper;

  return (
    <SvgWrapper side={side} scale={scale} border={border}>
      {assets.map((part) => {
        if (hiddenParts.includes(part.slug)) return null;

        const isDisabled = disabledParts.includes(part.slug);
        const fillColor = getColor(part.slug);

        return part.pathData.map((pathD, index) => (
          <path
            key={`${part.slug}-${index}`}
            d={pathD}
            fill={fillColor}
            onClick={isDisabled ? undefined : (e) => onClick?.(part.slug, e)}
            style={{ cursor: isDisabled ? 'default' : 'pointer' }}
            aria-disabled={isDisabled || undefined}
            data-testid={part.slug}
          />
        ));
      })}
    </SvgWrapper>
  );
};
```

7. **Select correct asset based on gender/side:**
```typescript
const getAssets = (): BodyPartAsset[] => {
  if (gender === "female") {
    return side === "front" ? bodyFemaleFront : bodyFemaleBack;
  }
  return side === "front" ? bodyFront : bodyBack;
};

return renderBodySvg(getAssets());
```

8. **Keep exports:**
```typescript
export default Body;
export { Body };
```

**Things to REMOVE:**
- `colors` prop and intensity-based color logic
- `onBodyPartPress` callback (replaced by `onClick`)
- `side` prop on data items (replaced by explicit left/right slugs)
- `styles` prop on data items (use color directly)
- `intensity` prop on data items
- `defaultStroke` and `defaultStrokeWidth` props (simplification)
- `differenceWith` import and mergedBodyParts logic
- Old type definitions (Slug, BodyPart, ExtendedBodyPart, BodyProps, BodyPartStyles)

**Things to KEEP:**
- `data`, `onClick`, `gender`, `side`, `scale`, `border`, `disabledParts`, `hiddenParts`, `defaultFill`
- SVG wrapper components
- Accessibility attributes (aria-disabled)
- cursor:pointer styling
  </action>
  <verify>
Run `npm run typecheck` - should pass.
Run `npm run build` - should succeed.
Grep for removed patterns:
- `grep -r "intensity" src/` should find nothing
- `grep -r "onBodyPartPress" src/` should find nothing
- `grep -r "colors:" src/index.tsx` should find nothing
- `grep -rE "exercise|workout" src/` should find nothing (API-02 verification)
  </verify>
  <done>
Body component refactored with simplified API. Uses ModelProps type. onClick callback with slug. No intensity system. No colors array. No onBodyPartPress. No exercise-related references. TypeScript compiles. Build succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove differenceWith utility</name>
  <files>src/utils/differenceWith.ts</files>
  <action>
Delete `src/utils/differenceWith.ts` - it's no longer used after the component refactor.

The file was used for merging user data with asset data, but with the new simplified approach we just use a Map lookup.
  </action>
  <verify>
File should not exist: `ls src/utils/differenceWith.ts` should fail.
Build should still succeed: `npm run build`.
  </verify>
  <done>
differenceWith.ts deleted. Build succeeds without it.
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify build and type exports</name>
  <files>dist/index.d.ts</files>
  <action>
Run full build and verify the output:

1. `npm run build`
2. Check dist/index.d.ts contains:
   - `export type { BodyPartSlug, BodyPartData, ModelProps }`
   - `export { Body }`
   - `export default Body`
3. Check dist/index.d.ts does NOT contain:
   - `Slug` (old type)
   - `ExtendedBodyPart` (old type)
   - `BodyProps` (old type - now ModelProps)
   - `intensity` (old prop)
   - `onBodyPartPress` (old callback)

4. Test import works:
```bash
node --input-type=module -e "import { Body, BodyPartSlug } from './dist/index.js'; console.log(typeof Body);"
```
Should print "function".

5. **Verify API-02 (no exercise references):**
```bash
grep -rE "exercise|workout" src/
```
Should return empty (no matches). This confirms all exercise-related code has been removed per API-02 requirement.
  </action>
  <verify>
Build succeeds.
ESM import test prints "function".
Type declarations contain new types, not old types.
No exercise/workout references in src/ directory.
  </verify>
  <done>
Build produces clean output with new API. Type declarations export BodyPartSlug, BodyPartData, ModelProps. Old types removed. ESM and CJS imports work. No exercise-related code remains (API-02 verified).
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. `npm run typecheck` succeeds
3. No intensity, colors, onBodyPartPress in source
4. No exercise/workout references in source (`grep -rE "exercise|workout" src/` returns empty)
5. dist/index.d.ts exports new types only
6. ESM import test works
7. CJS import test works
</verification>

<success_criteria>
- Body component uses ModelProps type
- onClick callback provides (slug, event)
- No intensity system anywhere
- No colors array prop
- No onBodyPartPress callback
- No exercise-related references (API-02)
- No old types exported
- New types (BodyPartSlug, BodyPartData, ModelProps) exported
- differenceWith.ts deleted
- Build produces working ESM and CJS bundles
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-migration/02-03-SUMMARY.md`
</output>
