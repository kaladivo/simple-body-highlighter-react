---
phase: 02-remote-docs-cicd
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .github/workflows/publish.yml
  - README.md
autonomous: true
user_setup: []

must_haves:
  truths:
    - "GitHub Actions workflow triggers on v* tag push"
    - "Workflow uses npm (not yarn) for consistency with project"
    - "Workflow uses current action versions (v6)"
    - "README contains NPM_TOKEN setup instructions"
    - "README installation command shows simple-body-highlighter-react"
  artifacts:
    - path: ".github/workflows/publish.yml"
      provides: "Tag-triggered npm publish workflow"
      contains: "push:\n    tags:\n      - 'v*'"
    - path: "README.md"
      provides: "NPM_TOKEN documentation"
      contains: "NPM_TOKEN"
  key_links:
    - from: ".github/workflows/publish.yml"
      to: "secrets.NPM_TOKEN"
      via: "NODE_AUTH_TOKEN env var"
      pattern: "NODE_AUTH_TOKEN.*secrets\\.NPM_TOKEN"
---

<objective>
Update GitHub Actions workflow for npm publishing and add CI/CD documentation to README.

Purpose: Prepare the publish infrastructure and documentation before pushing to new remote.
Output: Updated publish.yml workflow and README with NPM_TOKEN setup instructions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-remote-docs-cicd/02-RESEARCH.md
@.github/workflows/npm-publish.yml
@README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update GitHub Actions workflow for npm publishing</name>
  <files>.github/workflows/publish.yml</files>
  <action>
Rename `.github/workflows/npm-publish.yml` to `.github/workflows/publish.yml` (cleaner name per research).

Update workflow to use current best practices from 02-RESEARCH.md:

1. Update action versions:
   - actions/checkout@v6 (was v4)
   - actions/setup-node@v6 (was v4)

2. Update Node.js version to 20.x (was 18)

3. Replace yarn with npm:
   - `npm ci` instead of `yarn install --frozen-lockfile`
   - `npm test` instead of `yarn test`
   - `npm run typecheck` instead of `yarn typecheck`
   - `npm run build` instead of `yarn build`

4. Fix secret name: `NPM_TOKEN` (was `NPM_AUTH_TOKEN`)

5. Remove cache step (setup-node v6 handles caching automatically)

6. Keep the workflow structure:
   - Trigger on v* tags
   - Run tests, typecheck, build before publish
   - Use --access public flag

Reference workflow from 02-RESEARCH.md for exact structure.
  </action>
  <verify>
File `.github/workflows/publish.yml` exists with:
- `actions/checkout@v6`
- `actions/setup-node@v6`
- `node-version: '20.x'`
- `npm ci`, `npm test`, `npm run build`
- `secrets.NPM_TOKEN`
- `on: push: tags: - 'v*'`
  </verify>
  <done>
Workflow file uses current action versions, npm commands, and correct secret name.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add CI/CD documentation to README</name>
  <files>README.md</files>
  <action>
Add a "Publishing (Maintainers)" section at the end of README.md (before any footer content).

Section should include:

1. **How releases work** - Tag push triggers GitHub Actions workflow
2. **NPM_TOKEN setup** - Steps to create granular access token and add as GitHub secret
3. **Release workflow** - The `npm version` and `git push --tags` commands

Content to add:

```markdown
## Publishing (Maintainers)

Releases are automated via GitHub Actions. Pushing a version tag triggers npm publish.

### Setup (one-time)

1. Create npm granular access token at https://npmjs.com/settings/~/tokens:
   - Token name: `github-actions-publish`
   - Expiration: 90 days (max for write tokens)
   - Permissions: Read and write
   - Packages: Only `simple-body-highlighter-react`

2. Add token as GitHub secret:
   - Go to repository Settings > Secrets and variables > Actions
   - Create secret named `NPM_TOKEN`
   - Paste the token value

### Release workflow

```bash
# Update version (creates commit and tag)
npm version patch  # or minor/major

# Push commit and tag to trigger publish
git push && git push --tags
```

The workflow runs tests, type-checks, builds, then publishes to npm.
```

Verify existing README sections are intact (Installation, Quick Start, Props, etc.).
  </action>
  <verify>
README.md contains:
- "Publishing (Maintainers)" section
- "NPM_TOKEN" text
- "npm version" command
- "git push --tags" command
- All existing sections still present
  </verify>
  <done>
README includes CI/CD documentation with NPM_TOKEN setup instructions and release workflow.
  </done>
</task>

</tasks>

<verification>
- [ ] Old workflow file removed: `ls .github/workflows/npm-publish.yml` returns "not found"
- [ ] New workflow exists: `cat .github/workflows/publish.yml` shows updated content
- [ ] Actions use v6: `grep -E "actions/(checkout|setup-node)@v6" .github/workflows/publish.yml`
- [ ] npm commands used: `grep "npm ci" .github/workflows/publish.yml`
- [ ] Secret name correct: `grep "secrets.NPM_TOKEN" .github/workflows/publish.yml`
- [ ] README has CI docs: `grep "NPM_TOKEN" README.md`
- [ ] README has release workflow: `grep "npm version" README.md`
</verification>

<success_criteria>
1. `.github/workflows/publish.yml` exists with v* tag trigger
2. Workflow uses actions/checkout@v6 and actions/setup-node@v6
3. Workflow uses npm commands (not yarn)
4. Workflow references `secrets.NPM_TOKEN`
5. README contains "Publishing (Maintainers)" section with NPM_TOKEN setup
</success_criteria>

<output>
After completion, create `.planning/phases/02-remote-docs-cicd/02-01-SUMMARY.md`
</output>
